# ==============================================
# DATASOURCE CONFIGURATION
# ==============================================
spring.datasource.url=jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:geosegbar_dev}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:password}
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# ==============================================
# POOL DE CONEXÃ•ES HIKARI
# ==============================================
spring.datasource.hikari.keepalive-time=200000
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=3
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000
spring.jpa.properties.hibernate.connection.autocommit=false
spring.transaction.default-timeout=30
spring.datasource.hikari.auto-commit=false
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true

# ==============================================
# TOMCAT CONFIGURATION
# ==============================================
server.port=${SERVER_PORT:9090}
server.tomcat.max-threads=35
server.tomcat.threads.min-spare=10
server.tomcat.accept-count=100
server.tomcat.max-connections=200
server.tomcat.connection-timeout=20000
server.tomcat.keep-alive-timeout=5000
server.tomcat.max-keep-alive-requests=100
server.tomcat.max-http-header-size=8192
server.tomcat.max-http-post-size=2097152
server.tomcat.min-spare-threads=10

# ==============================================
# JPA/HIBERNATE
# ==============================================
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_size=10
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false
spring.jpa.properties.hibernate.bytecode.use_reflection_optimizer=false
spring.jpa.properties.hibernate.jdbc.time_zone=${TZ:America/Sao_Paulo}

# ==============================================
# SECURITY
# ==============================================
api.security.token.secret=${JWT_SECRET:default_secret_change_this}

# ==============================================
# EMAIL CONFIGURATION
# ==============================================
spring.mail.host=${MAIL_HOST:localhost}
spring.mail.port=${MAIL_PORT:465}
spring.mail.username=${MAIL_USERNAME:noreply@localhost}
spring.mail.password=${MAIL_PASSWORD:password}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.ssl.enable=true

# ==============================================
# FILE STORAGE
# ==============================================
file.upload-dir=${FILE_UPLOAD_DIR:/tmp/uploads}
file.base-url=${FILE_BASE_URL:/storage/}
file.psb-dir=${FILE_PSB_DIR:${file.upload-dir}/psb}

# ==============================================
# FRONTEND
# ==============================================
application.frontend-url=${FRONTEND_URL:http://localhost:3000}

# ==============================================
# EXTERNAL API - ANA
# ==============================================
ana.api.identifier=${ANA_API_IDENTIFIER:}
ana.api.password=${ANA_API_PASSWORD:}
ana.api.auth-url=${ANA_API_AUTH_URL:https://www.ana.gov.br/hidrowebservice/EstacoesTelemetricas/OAUth/v1}
ana.api.telemetry-url=${ANA_API_TELEMETRY_URL:https://www.ana.gov.br/hidrowebservice/EstacoesTelemetricas/HidroinfoanaSerieTelemetricaAdotada/v1}

# ==============================================
# COMPRESSION
# ==============================================
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# ==============================================
# REDIS CACHE CONFIGURATION
# ==============================================
spring.cache.type=redis
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=2000
spring.cache.redis.time-to-live=600000
spring.cache.redis.cache-null-values=false
spring.cache.redis.use-key-prefix=true
spring.cache.redis.key-prefix=geosegbar:
spring.data.redis.lettuce.pool.max-active=16
spring.data.redis.lettuce.pool.max-idle=8
spring.data.redis.lettuce.pool.min-idle=4
spring.data.redis.lettuce.pool.max-wait=1500ms
spring.data.redis.timeout=2000ms

# ==============================================
# HTTP CONFIGURATION
# ==============================================
server.tomcat.reject-illegal-header=false
server.tomcat.relaxed-query-chars=|,{,},[,]
server.tomcat.relaxed-path-chars=|,{,},[,]
server.http.encoding.force=true
server.servlet.encoding.charset=UTF-8
server.servlet.encoding.enabled=true